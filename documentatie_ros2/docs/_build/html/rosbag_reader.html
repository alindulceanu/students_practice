


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xml:lang="" lang="" version="-//W3C//DTD XHTML 1.1//EN" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Making a rosbag reader &mdash; Documentatie ros2 1.0 documentation</title>
  

  

  

    <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'/>
    <link rel="stylesheet" href="_static/css/pdj.css" type="text/css" />

  
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/css/pdj.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Documentatie ros2 1.0 documentation" href="index.html"/>
        <link rel="prev" title="Docker container in VSCode" href="DockerVS.html"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="cache-control" content="public" />
    <meta name="robots" content="follow, all" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Add jQuery library -->
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

  </head>

  <body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Documentatie ros2 </a>
        <div role="search">
	  <form id ="rtd-search-form" class="wy-form"
		action="search.html" method="get">
	    <input type="text" name="q" placeholder="Search docs" />
	    <input type="hidden" name="check_keywords" value="yes" />
	    <input type="hidden" name="area" value="default" />
	  </form>
	</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	
          
          
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup.html">Preparations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="setup.html#ubuntu-debian-packages">Ubuntu (Debian packages)</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#resources">Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#system-setup">System setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#install-ros-2">Install ROS 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#setup-environment">Setup environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#try-some-examples">Try some examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="start.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="start.html#creating-the-environment">Creating the environment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="step1_ros.html">Basic talker tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="step1_ros.html#creating-a-talker-using-python">Creating a talker using python</a></li>
<li class="toctree-l2"><a class="reference internal" href="step1_ros.html#building-and-running-the-node">Building and running the node</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Installing Docker Desktop</a><ul>
<li class="toctree-l2"><a class="reference internal" href="docker.html#what-is-docker">What is Docker?</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker.html#what-are-containers">What are containers?</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker.html#why-use-containers">Why use containers?</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker.html#setting-up-your-computer">Setting up your computer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docker.html#hello-world">HELLO WORLD</a><ul>
<li class="toctree-l2"><a class="reference internal" href="docker.html#playing-with-busybox">Playing with Busybox</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker.html#docker-run">Docker Run</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker.html#terminology">Terminology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docker.html#webapps-with-docker">WEBAPPS WITH DOCKER</a><ul>
<li class="toctree-l2"><a class="reference internal" href="docker.html#dockerfile">Dockerfile</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docker.html#conclusion">CONCLUSION</a></li>
<li class="toctree-l1"><a class="reference internal" href="VMBox.html">VMBox</a><ul>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#welcome-to-oracle-vm-virtualbox">Welcome to Oracle VM VirtualBox.</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#why-is-virtualization-useful">Why is Virtualization Useful?</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#some-terminology">Some Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#features-overview">Features Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="VMBox.html#supported-host-operating-systems">Supported Host Operating Systems</a><ul>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#host-cpu-requirements">Host CPU Requirements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="VMBox.html#installing-oracle-vm-virtualbox-and-extension-packs">Installing Oracle VM VirtualBox and Extension Packs</a></li>
<li class="toctree-l1"><a class="reference internal" href="VMBox.html#starting-oracle-vm-virtualbox">Starting Oracle VM VirtualBox</a></li>
<li class="toctree-l1"><a class="reference internal" href="VMBox.html#virtualbox-manager">VirtualBox Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="VMBox.html#the-machine-list">The Machine List</a></li>
<li class="toctree-l1"><a class="reference internal" href="VMBox.html#the-details-pane">The Details Pane</a><ul>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#virtualbox-manager-toolbar">VirtualBox Manager Toolbar</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#settings">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#preview-window">Preview Window</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#notification-center">Notification Center</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="VMBox.html#virtualbox-manager-tools">VirtualBox Manager Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#global-tools">Global Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#machine-tools">Machine Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="VMBox.html#help-viewer">Help Viewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="VMBox.html#about-virtualbox-manager-wizards">About VirtualBox Manager Wizards</a></li>
<li class="toctree-l1"><a class="reference internal" href="VMBox.html#creating-your-first-virtual-machine">Creating Your First Virtual Machine</a><ul>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#create-virtual-machine-wizard-name-and-operating-system">Create Virtual Machine Wizard: Name and Operating System</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#create-virtual-machine-wizard-hardware">Create Virtual Machine Wizard: Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#create-virtual-machine-wizard-virtual-hard-disk">Create Virtual Machine Wizard: Virtual Hard Disk</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#create-virtual-machine-wizard-summary">Create Virtual Machine Wizard: Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#some-examples-of-unattended-installation">Some Examples of Unattended Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="VMBox.html#running-your-virtual-machine">Running Your Virtual Machine</a><ul>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#starting-a-new-vm-for-the-first-time">Starting a New VM for the First Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#capturing-and-releasing-keyboard-and-mouse">Capturing and Releasing Keyboard and Mouse</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#typing-special-characters">Typing Special Characters</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#changing-removable-media">Changing Removable Media</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#resizing-the-machine-s-window">Resizing the Machine’s Window</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMBox.html#saving-the-state-of-the-machine">Saving the State of the Machine</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="framefinder.html">Making a rosbag frame, topic and value reader</a></li>
<li class="toctree-l1"><a class="reference internal" href="wsl2.html">WSL2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wsl2.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="wsl2.html#setting-up-the-linux-user">Setting up the linux user</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="talker.html">Making a ros2 talker</a></li>
<li class="toctree-l1"><a class="reference internal" href="subscriber.html">Making a ros2 subscriber</a><ul>
<li class="toctree-l2"><a class="reference internal" href="subscriber.html#initialization-method">Initialization Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="subscriber.html#callback-function">Callback Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="subscriber.html#main-function">Main Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="subscriber.html#final-result">Final result</a></li>
<li class="toctree-l2"><a class="reference internal" href="subscriber.html#add-an-entry-point">Add an entry point</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ScriptDock.html">Making a script to directly open the virtual image with docker and mount itself in vs code</a></li>
<li class="toctree-l1"><a class="reference internal" href="MobaX.html">Installing MobaXTerm</a><ul>
<li class="toctree-l2"><a class="reference internal" href="MobaX.html#mobaxterm-x-server-and-ssh-client">MobaXterm X server and SSH client</a></li>
<li class="toctree-l2"><a class="reference internal" href="MobaX.html#key-features">Key features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="DockerVS.html">Docker container in VSCode</a></li>
<li class="toctree-l1"><a class="reference internal" href="DockerVS.html#installing-docker-on-ubuntu">Installing Docker on Ubuntu</a><ul>
<li class="toctree-l2"><a class="reference internal" href="DockerVS.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="DockerVS.html#os-requirements">OS requirements:</a></li>
<li class="toctree-l2"><a class="reference internal" href="DockerVS.html#uninstall-old-versions">Uninstall old versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="DockerVS.html#installation-methods">Installation methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="DockerVS.html#install-using-the-apt-repository">Install using the apt repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="DockerVS.html#set-up-the-repository">Set up the repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="DockerVS.html#install-docker-engine">Install Docker Engine</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="DockerVS.html#uninstall-docker-engine">Uninstall Docker Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="DockerVS.html#linux-post-installation-steps-for-docker-engine">Linux post-installation steps for Docker Engine</a><ul>
<li class="toctree-l2"><a class="reference internal" href="DockerVS.html#manage-docker-as-a-non-root-user">Manage Docker as a non-root user</a></li>
<li class="toctree-l2"><a class="reference internal" href="DockerVS.html#configure-docker-to-start-on-boot-with-systemd">Configure Docker to start on boot with systemd</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Making a rosbag reader</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-pandas">What is pandas?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#making-the-script">Making the script</a></li>
<li class="toctree-l2"><a class="reference internal" href="#executing-the-code">Executing the code</a></li>
</ul>
</li>
</ul>

          
        

      </div>
      &nbsp;
    </nav>
    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      <nav class="wy-nav-top" id="barra-mobile" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="#">Porão do Juca</a>
      </nav>

      <div class="wy-nav-content">
	<div class="fundo-claro">
	</div>
	<div class="fundo-escuro">
	</div>

        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
	    
	    <!-- <ul class="wy-breadcrumbs"> -->
	    <!--   <li><a href="#">Docs</a> &raquo;</li> -->

	    <!--   <li>Features</li> -->
	    <!--   <li class="wy-breadcrumbs-aside"> -->

	    <!-- 	<a href="_sources/index.txt" rel="nofollow"> View page source</a> -->

	    <!--   </li> -->
	    <!-- </ul> -->
	    <!-- <hr/> -->
	  </div>

          <div role="main" class="">

	    <div id="content" class="hfeed entry-container hentry">
  <section id="making-a-rosbag-reader">
<h1>Making a rosbag reader<a class="headerlink" href="#making-a-rosbag-reader" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#what-is-pandas" id="id1">What is pandas?</a></p></li>
<li><p><a class="reference internal" href="#making-the-script" id="id2">Making the script</a></p>
<ul>
<li><p><a class="reference internal" href="#explanation" id="id3">Explanation</a></p></li>
<li><p><a class="reference internal" href="#full-script" id="id4">Full script</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#executing-the-code" id="id5">Executing the code</a></p></li>
</ul>
</nav>
<p>Now that we know what a rosbag is, we usually want to extract specific information from it. We can do that by loading the bag into a
<code class="docutils literal notranslate"><span class="pre">pandas</span></code> dataframe then make a basic search algorithm for it.</p>
<section id="what-is-pandas">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">What is pandas?</a><a class="headerlink" href="#what-is-pandas" title="Permalink to this heading">¶</a></h2>
<p>Pandas is an open source Python package that is most widely used for data science/data analysis and machine learning tasks. It is built on top of another package named Numpy, which provides support for multi-dimensional arrays. As one of the most popular data wrangling packages, Pandas works well with many other data science modules inside the Python ecosystem, and is typically included in every Python distribution, from those that come with your operating system to commercial vendor distributions like ActiveState’s ActivePython.</p>
</section>
<section id="making-the-script">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Making the script</a><a class="headerlink" href="#making-the-script" title="Permalink to this heading">¶</a></h2>
<p>Now that we are familliar with pandas we can start building the script.</p>
<section id="explanation">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Explanation</a><a class="headerlink" href="#explanation" title="Permalink to this heading">¶</a></h3>
<p><strong>Import Required Libraries</strong>:</p>
<p>Import the necessary libraries and modules, including argparse for command-line argument parsing, rclpy for ROS 2 communication, utilities for message deserialization, specific message types (e.g., Twist), rosbag2_py for working with ROS 2 bags, and pandas for data manipulation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">rclpy.serialization</span> <span class="kn">import</span> <span class="n">deserialize_message</span>
<span class="kn">from</span> <span class="nn">rosidl_runtime_py.utilities</span> <span class="kn">import</span> <span class="n">get_message</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Twist</span>
<span class="kn">import</span> <span class="nn">rosbag2_py</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
<p><strong>Define a Function to Read Messages from a ROS 2 Bag</strong>:</p>
<p>Define the <cite>read_messages</cite> function, which reads and deserializes messages from a ROS 2 bag file. It opens the bag file using rosbag2_py and iterates through the messages, extracting topic names, message data, and timestamps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_messages</span><span class="p">(</span><span class="n">input_bag</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">first</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span>

    <span class="n">reader</span> <span class="o">=</span> <span class="n">rosbag2_py</span><span class="o">.</span><span class="n">SequentialReader</span><span class="p">()</span>
    <span class="n">reader</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
        <span class="n">rosbag2_py</span><span class="o">.</span><span class="n">StorageOptions</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">input_bag</span><span class="p">,</span> <span class="n">storage_id</span><span class="o">=</span><span class="s2">&quot;mcap&quot;</span><span class="p">),</span>
        <span class="n">rosbag2_py</span><span class="o">.</span><span class="n">ConverterOptions</span><span class="p">(</span>
            <span class="n">input_serialization_format</span><span class="o">=</span><span class="s2">&quot;cdr&quot;</span><span class="p">,</span> <span class="n">output_serialization_format</span><span class="o">=</span><span class="s2">&quot;cdr&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">topic_types</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">get_all_topics_and_types</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">typename</span><span class="p">(</span><span class="n">topic_name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">topic_type</span> <span class="ow">in</span> <span class="n">topic_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">topic_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">topic_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">topic_type</span><span class="o">.</span><span class="n">type</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;topic </span><span class="si">{</span><span class="n">topic_name</span><span class="si">}</span><span class="s2"> not in bag&quot;</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">reader</span><span class="o">.</span><span class="n">has_next</span><span class="p">():</span>
        <span class="n">topic</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_next</span><span class="p">()</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">timestamp</span> <span class="o">%</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">14</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">first</span> <span class="o">==</span> <span class="s2">&quot;-1&quot;</span><span class="p">:</span>
            <span class="n">first</span> <span class="o">=</span> <span class="n">frame</span>

        <span class="n">msg_type</span> <span class="o">=</span> <span class="n">get_message</span><span class="p">(</span><span class="n">typename</span><span class="p">(</span><span class="n">topic</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">deserialize_message</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">msg_type</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">topic</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">frame</span> <span class="o">-</span> <span class="n">first</span>
    <span class="k">del</span> <span class="n">reader</span>
</pre></div>
</div>
<p><strong>Create an Empty DataFrame</strong>:</p>
<p>Inside the main function create an empty pandas DataFrame named <cite>df</cite> with columns to store data extracted from the bag file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;FRAME&quot;</span><span class="p">,</span> <span class="s2">&quot;TOPIC&quot;</span><span class="p">,</span> <span class="s2">&quot;linX&quot;</span><span class="p">,</span> <span class="s2">&quot;linY&quot;</span><span class="p">,</span> <span class="s2">&quot;linZ&quot;</span><span class="p">,</span> <span class="s2">&quot;angX&quot;</span><span class="p">,</span> <span class="s2">&quot;angY&quot;</span><span class="p">,</span> <span class="s2">&quot;angZ&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p><strong>Parse Command-Line Arguments</strong>:</p>
<p>Parse command-line arguments using the argparse module to specify the input bag file, desired topics, frames, and values for analysis.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;input bag path (folder or filepath) to read from&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;--topic&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--frame&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="s1">&#39;--value&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Read Messages from the Bag and Populate DataFrame</strong>:</p>
<p>Iterate through messages in the bag file, extract Twist messages, and populate the DataFrame <cite>df</cite> with the data. It also saves the DataFrame to a CSV file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">read_messages</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">input</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">Twist</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;FRAME&quot;</span><span class="p">:</span> <span class="n">frame</span><span class="p">,</span> <span class="s2">&quot;TOPIC&quot;</span><span class="p">:</span> <span class="n">topic</span><span class="p">,</span> <span class="s2">&quot;linX&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;linY&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;linZ&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="s2">&quot;angX&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;angY&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;angZ&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span><span class="p">}</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_row</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;~/ros2_ws/src/my_robot_controller/data2.csv&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Search and Print Data from the DataFrame</strong>:</p>
<p>Search for and print data from the DataFrame based on specified topics, frames, and values. It provides search results based on user-defined criteria.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">topic</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">frm</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">frame</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Search result: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;FRAME&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="n">frm</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;TOPIC&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">str</span><span class="p">(</span><span class="n">top</span><span class="p">)),</span><span class="w"> </span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot; topic: </span><span class="si">{</span><span class="n">top</span><span class="si">}</span><span class="s2">, frame: </span><span class="si">{</span><span class="n">frm</span><span class="si">}</span><span class="s2">, column: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Handle Errors and Invalid Inputs</strong>:</p>
<p>Handle exceptions and display an error message if there are any issues with the provided input.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[ERROR] Invalid input!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Entry Point of the Script</strong>:</p>
<p>Define the entry point of the script, which calls the <cite>main</cite> function when the script is executed directly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="full-script">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Full script</a><a class="headerlink" href="#full-script" title="Permalink to this heading">¶</a></h3>
<p>The code should look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">rclpy.serialization</span> <span class="kn">import</span> <span class="n">deserialize_message</span>
<span class="kn">from</span> <span class="nn">rosidl_runtime_py.utilities</span> <span class="kn">import</span> <span class="n">get_message</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Twist</span>
<span class="kn">import</span> <span class="nn">rosbag2_py</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">read_messages</span><span class="p">(</span><span class="n">input_bag</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">first</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span>

    <span class="n">reader</span> <span class="o">=</span> <span class="n">rosbag2_py</span><span class="o">.</span><span class="n">SequentialReader</span><span class="p">()</span>
    <span class="n">reader</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
        <span class="n">rosbag2_py</span><span class="o">.</span><span class="n">StorageOptions</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">input_bag</span><span class="p">,</span> <span class="n">storage_id</span><span class="o">=</span><span class="s2">&quot;mcap&quot;</span><span class="p">),</span>
        <span class="n">rosbag2_py</span><span class="o">.</span><span class="n">ConverterOptions</span><span class="p">(</span>
            <span class="n">input_serialization_format</span><span class="o">=</span><span class="s2">&quot;cdr&quot;</span><span class="p">,</span> <span class="n">output_serialization_format</span><span class="o">=</span><span class="s2">&quot;cdr&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">topic_types</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">get_all_topics_and_types</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">typename</span><span class="p">(</span><span class="n">topic_name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">topic_type</span> <span class="ow">in</span> <span class="n">topic_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">topic_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">topic_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">topic_type</span><span class="o">.</span><span class="n">type</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;topic </span><span class="si">{</span><span class="n">topic_name</span><span class="si">}</span><span class="s2"> not in bag&quot;</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">reader</span><span class="o">.</span><span class="n">has_next</span><span class="p">():</span>
        <span class="n">topic</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_next</span><span class="p">()</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">timestamp</span> <span class="o">%</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">14</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">first</span> <span class="o">==</span> <span class="s2">&quot;-1&quot;</span><span class="p">:</span>
            <span class="n">first</span> <span class="o">=</span> <span class="n">frame</span>

        <span class="n">msg_type</span> <span class="o">=</span> <span class="n">get_message</span><span class="p">(</span><span class="n">typename</span><span class="p">(</span><span class="n">topic</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">deserialize_message</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">msg_type</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">topic</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">frame</span> <span class="o">-</span> <span class="n">first</span>
    <span class="k">del</span> <span class="n">reader</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;FRAME&quot;</span><span class="p">,</span> <span class="s2">&quot;TOPIC&quot;</span><span class="p">,</span> <span class="s2">&quot;linX&quot;</span><span class="p">,</span> <span class="s2">&quot;linY&quot;</span><span class="p">,</span> <span class="s2">&quot;linZ&quot;</span><span class="p">,</span> <span class="s2">&quot;angX&quot;</span><span class="p">,</span> <span class="s2">&quot;angY&quot;</span><span class="p">,</span> <span class="s2">&quot;angZ&quot;</span><span class="p">])</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;input bag path (folder or filepath) to read from&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;--topic&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--frame&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="s1">&#39;--value&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">read_messages</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">input</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">Twist</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;FRAME&quot;</span><span class="p">:</span> <span class="n">frame</span><span class="p">,</span> <span class="s2">&quot;TOPIC&quot;</span><span class="p">:</span> <span class="n">topic</span><span class="p">,</span> <span class="s2">&quot;linX&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;linY&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;linZ&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="s2">&quot;angX&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;angY&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;angZ&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span><span class="p">}</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_row</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;~/ros2_ws/src/my_robot_controller/data2.csv&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">topic</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">frm</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">frame</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Search result: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;FRAME&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="n">frm</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;TOPIC&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">str</span><span class="p">(</span><span class="n">top</span><span class="p">)),</span><span class="w"> </span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot; topic: </span><span class="si">{</span><span class="n">top</span><span class="si">}</span><span class="s2">, frame: </span><span class="si">{</span><span class="n">frm</span><span class="si">}</span><span class="s2">, column: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[ERROR] Invalid input!&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="executing-the-code">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Executing the code</a><a class="headerlink" href="#executing-the-code" title="Permalink to this heading">¶</a></h2>
<p>Since this script is not a node, it can be placed anywhere on your pc and it does not need to be build along the other ROS files.</p>
<p>In order to use it simply use this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">&lt;</span><span class="n">path_to_this_script</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">path_to_the_rosbag</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">t</span> <span class="o">&lt;</span><span class="n">target_topic</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">f</span> <span class="o">&lt;</span><span class="n">target_frame</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">v</span> <span class="o">&lt;</span><span class="n">target_value</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keep in mind that you must use all the flags (-t, -f, -v) at least once!</p>
</div>
</section>
</section>


	    </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="DockerVS.html" class="btn btn-neutral" title="Docker container in VSCode"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, Alin Dulceanu, Eduard Cimpean.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/jucacrispim/sphinx_pdj_theme">theme</a> provided by <a href="http://poraodojuca.net">Porão do Juca</a>.

</footer>
	</div>
	</div>
	  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
    <script type="text/javascript" src="_static/documentation_options.js">

    </script>
    <script type="text/javascript" src="_static/doctools.js">

    </script>
    <script type="text/javascript" src="_static/sphinx_highlight.js">

    </script>
    <script type="text/javascript" src="_static/clipboard.min.js">

    </script>
    <script type="text/javascript" src="_static/copybutton.js">

    </script>

  

   <script type="text/javascript"
           src="_static/js/theme.js"></script>

   <script type="text/javascript"
           src="_static/js/pdj.js"></script>

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

  </body>
</html>